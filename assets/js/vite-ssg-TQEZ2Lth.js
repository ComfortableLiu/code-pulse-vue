import{c as x}from"./hookable-B8xFkYCm.js";import{d as $,r as I,k as z,S as D}from"./@vue-B8PMCPwU.js";import{c as W,a as U}from"./vue-router-DB5MEJjo.js";const V=new Set(["link","style","script","noscript"]),F=new Set(["title","titleTemplate","script","style","noscript"]),k=new Set(["base","meta","link","style","script","noscript"]),G=new Set(["title","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"]),N=new Set(["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"]),q=new Set(["key","tagPosition","tagPriority","tagDuplicateStrategy","innerHTML","textContent","processTemplateParams"]),J=new Set(["templateParams","htmlAttrs","bodyAttrs"]),K=new Set(["theme-color","google-site-verification","og","article","book","profile","twitter","author"]),B=["name","property","http-equiv"],Q=new Set(["viewport","description","keywords","robots"]);function R(e){const t=e.split(":");return t.length?K.has(t[1]):!1}function M(e){const{props:t,tag:n}=e;if(N.has(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";if(e.tag==="meta"){for(const r of B)if(t[r]!==void 0){const c=t[r],l=c.includes(":"),p=Q.has(c),g=!(l||p)&&e.key?`:key:${e.key}`:"";return`${n}:${c}${g}`}}if(e.key)return`${n}:key:${e.key}`;if(t.id)return`${n}:id:${t.id}`;if(F.has(n)){const r=e.textContent||e.innerHTML;if(r)return`${n}:content:${r}`}}function C(e){const t=e._h||e._d;if(t)return t;const n=e.textContent||e.innerHTML;return n||`${e.tag}:${Object.entries(e.props).map(([r,c])=>`${r}:${String(c)}`).join(",")}`}function A(e,t,n){typeof e==="function"&&(!n||n!=="titleTemplate"&&!(n[0]==="o"&&n[1]==="n"))&&(e=e());let c;if(t&&(c=t(n,e)),Array.isArray(c))return c.map(l=>A(l,t));if(c?.constructor===Object){const l={};for(const p of Object.keys(c))l[p]=A(c[p],t,p);return l}return c}function X(e,t){const n=e==="style"?new Map:new Set;function r(c){const l=c.trim();if(l)if(e==="style"){const[p,...a]=l.split(":").map(g=>g.trim());p&&a.length&&n.set(p,a.join(":"))}else l.split(" ").filter(Boolean).forEach(p=>n.add(p))}return typeof t=="string"?e==="style"?t.split(";").forEach(r):r(t):Array.isArray(t)?t.forEach(c=>r(c)):t&&typeof t=="object"&&Object.entries(t).forEach(([c,l])=>{l&&l!=="false"&&(e==="style"?n.set(c.trim(),l):r(c))}),n}function O(e,t){return e.props=e.props||{},t&&Object.entries(t).forEach(([n,r])=>{if(r===null){e.props[n]=null;return}if(n==="class"||n==="style"){e.props[n]=X(n,r);return}if(q.has(n)){if(["textContent","innerHTML"].includes(n)&&typeof r=="object"){let p=t.type;if(t.type||(p="application/json"),!p?.endsWith("json")&&p!=="speculationrules")return;t.type=p,e.props.type=p,e[n]=JSON.stringify(r)}else e[n]=r;return}const c=String(r),l=n.startsWith("data-");c==="true"||c===""?e.props[n]=l?c:!0:!r&&l&&c==="false"?e.props[n]="false":r!==void 0&&(e.props[n]=r)}),e}function Y(e,t){const n=typeof t=="object"&&typeof t!="function"?t:{[e==="script"||e==="noscript"||e==="style"?"innerHTML":"textContent"]:t},r=O({tag:e,props:{}},n);return r.key&&V.has(r.tag)&&(r.props["data-hid"]=r._h=r.key),r.tag==="script"&&typeof r.innerHTML=="object"&&(r.innerHTML=JSON.stringify(r.innerHTML),r.props.type=r.props.type||"application/json"),Array.isArray(r.props.content)?r.props.content.map(c=>({...r,props:{...r.props,content:c}})):r}function Z(e,t){if(!e)return[];typeof e=="function"&&(e=e());const n=(c,l)=>{for(let p=0;p<t.length;p++)l=t[p](c,l);return l};e=n(void 0,e);const r=[];return e=A(e,n),Object.entries(e||{}).forEach(([c,l])=>{if(l!==void 0)for(const p of Array.isArray(l)?l:[l])r.push(Y(c,p))}),r.flat()}const H=(e,t)=>e._w===t._w?e._p-t._p:e._w-t._w,P={base:-10,title:10},ee={critical:-8,high:-1,low:2},L={meta:{"content-security-policy":-30,charset:-20,viewport:-15},link:{preconnect:20,stylesheet:60,preload:70,modulepreload:70,prefetch:90,"dns-prefetch":90,prerender:90},script:{async:30,defer:80,sync:50},style:{imported:40,sync:60}},te=/@import/,b=e=>e===""||e===!0;function ne(e,t){if(typeof t.tagPriority=="number")return t.tagPriority;let n=100;const r=ee[t.tagPriority]||0,c=e.resolvedOptions.disableCapoSorting?{link:{},script:{},style:{}}:L;if(t.tag in P)n=P[t.tag];else if(t.tag==="meta"){const l=t.props["http-equiv"]==="content-security-policy"?"content-security-policy":t.props.charset?"charset":t.props.name==="viewport"?"viewport":null;l&&(n=L.meta[l])}else t.tag==="link"&&t.props.rel?n=c.link[t.props.rel]:t.tag==="script"?b(t.props.async)?n=c.script.async:t.props.src&&!b(t.props.defer)&&!b(t.props.async)&&t.props.type!=="module"&&!t.props.type?.endsWith("json")?n=c.script.sync:b(t.props.defer)&&t.props.src&&!b(t.props.async)&&(n=c.script.defer):t.tag==="style"&&(n=t.innerHTML&&te.test(t.innerHTML)?c.style.imported:c.style.sync);return(n||100)+r}function E(e,t){const n=typeof t=="function"?t(e):t,r=n.key||String(e.plugins.size+1);e.plugins.get(r)||(e.plugins.set(r,n),e.hooks.addHooks(n.hooks||{}))}function se(e={}){const t=x();t.addHooks(e.hooks||{});const n=!e.document,r=new Map,c=new Map,l=new Set,p={_entryCount:1,plugins:c,dirty:!1,resolvedOptions:e,hooks:t,ssr:n,entries:r,headEntries(){return[...r.values()]},use:a=>E(p,a),push(a,g){const m={...g||{}};delete m.head;const h=m._index??p._entryCount++,w={_i:h,input:a,options:m},f={_poll(s=!1){p.dirty=!0,!s&&l.add(h),t.callHook("entries:updated",p)},dispose(){r.delete(h)&&p.invalidate()},patch(s){(!m.mode||m.mode==="server"&&n||m.mode==="client"&&!n)&&(w.input=s,r.set(h,w),f._poll())}};return f.patch(a),f},async resolveTags(){const a={tagMap:new Map,tags:[],entries:[...p.entries.values()]};for(await t.callHook("entries:resolve",a);l.size;){const f=l.values().next().value;l.delete(f);const s=r.get(f);if(s){const i={tags:Z(s.input,e.propResolvers||[]).map(o=>Object.assign(o,s.options)),entry:s};await t.callHook("entries:normalize",i),s._tags=i.tags.map((o,y)=>(o._w=ne(p,o),o._p=(s._i<<10)+y,o._d=M(o),o))}}let g=!1;a.entries.flatMap(f=>(f._tags||[]).map(s=>({...s,props:{...s.props}}))).sort(H).reduce((f,s)=>{const i=String(s._d||s._p);if(!f.has(i))return f.set(i,s);const o=f.get(i);if((s?.tagDuplicateStrategy||(J.has(s.tag)?"merge":null)||(s.key&&s.key===o.key?"merge":null))==="merge"){const d={...o.props};Object.entries(s.props).forEach(([u,S])=>d[u]=u==="style"?new Map([...o.props.style||new Map,...S]):u==="class"?new Set([...o.props.class||new Set,...S]):S),f.set(i,{...s,props:d})}else s._p>>10===o._p>>10&&s.tag==="meta"&&R(i)?(f.set(i,Object.assign([...Array.isArray(o)?o:[o],s],s)),g=!0):(s._w===o._w?s._p>o._p:s?._w<o?._w)&&f.set(i,s);return f},a.tagMap);const m=a.tagMap.get("title"),h=a.tagMap.get("titleTemplate");if(p._title=m?.textContent,h){const f=h?.textContent;if(p._titleTemplate=f,f){let s=typeof f=="function"?f(m?.textContent):f;typeof s=="string"&&!p.plugins.has("template-params")&&(s=s.replace("%s",m?.textContent||"")),m?s===null?a.tagMap.delete("title"):a.tagMap.set("title",{...m,textContent:s}):(h.tag="title",h.textContent=s)}}a.tags=Array.from(a.tagMap.values()),g&&(a.tags=a.tags.flat().sort(H)),await t.callHook("tags:beforeResolve",a),await t.callHook("tags:resolve",a),await t.callHook("tags:afterResolve",a);const w=[];for(const f of a.tags){const{innerHTML:s,tag:i,props:o}=f;if(G.has(i)&&!(Object.keys(o).length===0&&!f.innerHTML&&!f.textContent)&&!(i==="meta"&&!o.content&&!o["http-equiv"]&&!o.charset)){if(i==="script"&&s){if(o.type?.endsWith("json")){const y=typeof s=="string"?s:JSON.stringify(s);f.innerHTML=y.replace(/</g,"\\u003C")}else typeof s=="string"&&(f.innerHTML=s.replace(new RegExp(`</${i}`,"g"),`<\\/${i}`));f._d=M(f)}w.push(f)}}return w},invalidate(){for(const a of r.values())l.add(a._i);p.dirty=!0,t.callHook("entries:updated",p)}};return(e?.plugins||[]).forEach(a=>E(p,a)),p.hooks.callHook("init",p),e.init?.forEach(a=>a&&p.push(a)),p}async function v(e,t={}){const n=t.document||e.resolvedOptions.document;if(!n||!e.dirty)return;const r={shouldRender:!0,tags:[]};if(await e.hooks.callHook("dom:beforeRender",r),!!r.shouldRender)return e._domUpdatePromise||(e._domUpdatePromise=new Promise(async c=>{const l=new Map,p=new Promise(s=>{e.resolveTags().then(i=>{s(i.map(o=>{const y=l.get(o._d)||0,d={tag:o,id:(y?`${o._d}:${y}`:o._d)||C(o),shouldRender:!0};return o._d&&R(o._d)&&l.set(o._d,y+1),d}))})});let a=e._dom;if(!a){a={title:n.title,elMap:new Map().set("htmlAttrs",n.documentElement).set("bodyAttrs",n.body)};for(const s of["body","head"]){const i=n[s]?.children;for(const o of i){const y=o.tagName.toLowerCase();if(!k.has(y))continue;const d=O({tag:y,props:{}},{innerHTML:o.innerHTML,...o.getAttributeNames().reduce((u,S)=>(u[S]=o.getAttribute(S),u),{})||{}});if(d.key=o.getAttribute("data-hid")||void 0,d._d=M(d)||C(d),a.elMap.has(d._d)){let u=1,S=d._d;for(;a.elMap.has(S);)S=`${d._d}:${u++}`;a.elMap.set(S,o)}else a.elMap.set(d._d,o)}}}a.pendingSideEffects={...a.sideEffects},a.sideEffects={};function g(s,i,o){const y=`${s}:${i}`;a.sideEffects[y]=o,delete a.pendingSideEffects[y]}function m({id:s,$el:i,tag:o}){const y=o.tag.endsWith("Attrs");a.elMap.set(s,i),y||(o.textContent&&o.textContent!==i.textContent&&(i.textContent=o.textContent),o.innerHTML&&o.innerHTML!==i.innerHTML&&(i.innerHTML=o.innerHTML),g(s,"el",()=>{i?.remove(),a.elMap.delete(s)}));for(const d in o.props){if(!Object.prototype.hasOwnProperty.call(o.props,d))continue;const u=o.props[d];if(d.startsWith("on")&&typeof u=="function"){const _=i?.dataset;if(_&&_[`${d}fired`]){const T=d.slice(0,-5);u.call(i,new Event(T.substring(2)))}i.getAttribute(`data-${d}`)!==""&&((o.tag==="bodyAttrs"?n.defaultView:i).addEventListener(d.substring(2),u.bind(i)),i.setAttribute(`data-${d}`,""));continue}const S=`attr:${d}`;if(d==="class"){if(!u)continue;for(const _ of u)y&&g(s,`${S}:${_}`,()=>i.classList.remove(_)),!i.classList.contains(_)&&i.classList.add(_)}else if(d==="style"){if(!u)continue;for(const[_,T]of u)g(s,`${S}:${_}`,()=>{i.style.removeProperty(_)}),i.style.setProperty(_,T)}else u!==!1&&u!==null&&(i.getAttribute(d)!==u&&i.setAttribute(d,u===!0?"":String(u)),y&&g(s,S,()=>i.removeAttribute(d)))}}const h=[],w={bodyClose:void 0,bodyOpen:void 0,head:void 0},f=await p;for(const s of f){const{tag:i,shouldRender:o,id:y}=s;if(o){if(i.tag==="title"){n.title=i.textContent,g("title","",()=>n.title=a.title);continue}s.$el=s.$el||a.elMap.get(y),s.$el?m(s):k.has(i.tag)&&h.push(s)}}for(const s of h){const i=s.tag.tagPosition||"head";s.$el=n.createElement(s.tag.tag),m(s),w[i]=w[i]||n.createDocumentFragment(),w[i].appendChild(s.$el)}for(const s of f)await e.hooks.callHook("dom:renderTag",s,n,g);w.head&&n.head.appendChild(w.head),w.bodyOpen&&n.body.insertBefore(w.bodyOpen,n.body.firstChild),w.bodyClose&&n.body.appendChild(w.bodyClose);for(const s in a.pendingSideEffects)a.pendingSideEffects[s]();e._dom=a,await e.hooks.callHook("dom:rendered",{renders:f}),c()}).finally(()=>{e._domUpdatePromise=void 0,e.dirty=!1})),e._domUpdatePromise}function re(e={}){const t=e.domOptions?.render||v;e.document=e.document||(typeof window<"u"?document:void 0);const n=e.document?.head.querySelector('script[id="unhead:payload"]')?.innerHTML||!1;return se({...e,plugins:[...e.plugins||[],{key:"client",hooks:{"entries:updated":t}}],init:[n?JSON.parse(n):!1,...e.init||[]]})}function oe(e,t){let n=0;return()=>{const r=++n;t(()=>{n===r&&e()})}}const ie="usehead";function ae(e){return{install(n){n.config.globalProperties.$unhead=e,n.config.globalProperties.$head=e,n.provide(ie,e)}}.install}function ce(e={}){const t=re({domOptions:{render:oe(()=>v(t),n=>setTimeout(n,0))},...e});return t.install=ae(t),t}function pe(e){return document.readyState==="loading"?new Promise(t=>{document.addEventListener("DOMContentLoaded",()=>t(e))}):Promise.resolve(e)}const le=$({setup(e,{slots:t}){const n=I(!1);return z(()=>n.value=!0),()=>n.value?t.default&&t.default({}):t.placeholder&&t.placeholder({})}});function fe(e){try{return JSON.parse(e||"{}")}catch(t){return console.error("[SSG] On state deserialization -",t,e),{}}}function he(e,t,n,r){const{transformState:c,registerComponents:l=!0,useHead:p=!0,rootContainer:a="#app"}={};async function g(m){const h=D(e);let w;p&&h.use(w=ce());const f=W({history:U(t.base),...t}),{routes:s}=t;l&&h.component("ClientOnly",le);const i=[],d={app:h,head:w,isClient:!0,router:f,routes:s,onSSRAppRendered:()=>{},triggerOnSSRAppRendered:()=>Promise.all(i.map(T=>T())),initialState:{},transformState:c,routePath:m};await pe(),d.initialState=c?.(window.__INITIAL_STATE__||{})||fe(window.__INITIAL_STATE__),await n?.(d),h.use(f);let u,S=!0;f.beforeEach((T,de,j)=>{(S||u&&u===T.path)&&(S=!1,u=T.path,T.meta.state=d.initialState),j()});const _=d.initialState;return{...d,initialState:_}}return(async()=>{const{app:m,router:h}=await g();await h.isReady(),m.mount(a,!0)})(),g}export{he as V};
