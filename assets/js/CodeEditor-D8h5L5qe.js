import{b as E}from"./codemirror-hwvxDye2.js";import{f as j,p as B,a as F,b as T,N as V}from"./prettier-B5g_hT_O.js";import{z as g,A as N,B as H,C as I,S as v,D as O,F as r,G as d,E as W,H as z,j as D,I as M}from"./@codemirror-BPrm9nb3.js";import{d as A,r as x,k as G,b as J,m as K,W as L,a4 as y,Y as _,_ as Q,a3 as R,a5 as U,a0 as X,V as Y,X as b,J as $}from"./@vue-DhwFsn5i.js";import{_ as q}from"./app-C48lt2-L.js";async function P(i,n){return!n||n==="text"?i:j(i,{parser:n,tabWidth:2,singleQuote:!0,semi:!1,plugins:[B,F,T,V]})}const Z={class:"extension-action"},tt=A({__name:"CodeEditor",props:{value:{},language:{},style:{},containerStyle:{},showFormat:{type:Boolean}},emits:["update:value","formatError"],setup(i,{expose:n,emit:C}){const f={javascript:{extension:g({typescript:!1,jsx:!0}),format:"babel"},json:{extension:z(),format:"json"},html:{extension:I(),format:"html"},css:{extension:H(),format:"css"},markdown:{extension:N(),format:"markdown"},text:{extension:void 0,format:"text"},typescript:{extension:g({typescript:!0,jsx:!0}),format:"typescript"}},a=i,c=C,m=x(null);let e;const l=x(a.value),p=v.define({map:(t,o)=>t.map(o)}),u=v.define(),k=O.define({create(){return d.none},update(t,o){t=t.map(o.changes);for(const s of o.effects)s.is(p)?t=t.update({add:[s.value]}):s.is(u)&&(t=d.none);return t},provide:t=>r.decorations.from(t)});G(()=>{e=new r({state:W.create({doc:a.value||"",extensions:[E,f[a.language].extension,r.lineWrapping,r.updateListener.of(t=>{t.docChanged&&(l.value=t.state.doc.toString(),c("update:value",l.value))}),k,D({activateOnTyping:!0,maxRenderedOptions:20,defaultKeymap:!0})].filter(t=>!!t)}),parent:m.value})}),J(()=>a.value,t=>{if(t!==l.value&&e){const o=e.state.update({changes:{from:0,to:e.state.doc.length,insert:t}});e.dispatch(o)}});const h=async()=>{if(e)try{const t=e.state.doc.toString(),o=await P(t,f[a.language].format);e.dispatch({changes:{from:0,to:t.length,insert:o}}),c("formatError",void 0)}catch(t){const o=t.loc.start.line;w(o),c("formatError",t)}},w=t=>{if(t===0){e.dispatch({effects:u.of(null)});return}const o=e.state.doc.line(t),S=d.line({attributes:{style:"background-color: rgb(255, 229, 224)"}}).range(o.from);e.dispatch({effects:[p.of(S),r.scrollIntoView(M.range(e.state.doc.line(t).from,e.state.doc.line(t).to))]})};return n({doFormatCode:h}),K(()=>{e&&e.destroy()}),(t,o)=>{const s=Y("a-button");return b(),L("div",{class:"container",style:y(a.containerStyle)},[_("div",{ref_key:"editorContainer",ref:m,class:"editor",style:y(a.style)},null,4),_("div",Z,[a.showFormat?(b(),Q(s,{key:0,onClick:h},{default:X(()=>o[0]||(o[0]=[$(" 格式化 ",-1)])),_:1,__:[0]})):R("",!0),U(t.$slots,"button",{},void 0)])],4)}}}),rt=q(tt,[["__scopeId","data-v-1133eafd"]]);export{rt as C};
